@page
@using System.Data
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    @*     <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p> *@
</div>
<div class="row ">
    <div class="col-lg-12 mt-8 d-flex justify-content-center align-items-center">

        <!-- Group Selection Card -->
        <div class="card card-default col-6">
            <div class="card-header align-items-center">
                <h2 class="">Choose the User Group</h2>
            </div>
            <div class="card-body">
                <form method="post">
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- Testing Status -->
                            <div class="form-floating mb-2">
                                <select id="gGroups" class="form-select" id="Groups">
                                    @{
                                        int rowIndex = 1;
                                    }
                                    @foreach (var row in Model.gGroup)
                                    {
                                        <option value="@rowIndex">@row</option>
                                        rowIndex++;
                                    } 
                                </select>
                                <label for="Groups">Groups</label>
                            </div>
                        </div>

                        <div class="col-lg-12 d-flex justify-content-end">
                            <div class="row" style="margin: 0;">
                                <button type="button" class="btn btn-primary m-auto" onclick="gBeginSession()">
                                   Begin the Intugent PI Session
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>

    </div>
</div>

<script>
    // send id to server-side
    function sendId() {
        var form = $('#MainWindowForm');
        
        $.ajax({
            type: "POST",
            url: "/Index?handler=SendID",
            headers: { "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() },
            data: form.serialize(),
            success: function (response) {
                console.log('Server response:', response);
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            }
        });
    }
    function gBeginSession() {
        var values = $('#gGroups').val();
        console.log(values);
        var form = $('#SearchParamsForm');

        $.ajax({
            type: "POST",
            url: "/Index?handler=GBeginSession_Click",
            headers: { "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() },
            data: {
                values: values
            },
            success: function (response) {
               //console.log('Server response:', response);
                location.reload();
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            }
        });
    }
</script>